@model BookingHomestay.ViewModels.BookingViewModel
@{
    ViewData["Title"] = "Đặt phòng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="booking-section py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-gradient-primary text-white text-center py-4">
                        <h3 class="fw-bold mb-0">@Model.Room.RoomName</h3>
                        <p class="mb-0">@Model.Room.RoomType</p>
                    </div>
                    <div class="card-body p-5">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <!-- Carousel ảnh phòng -->
                                <div id="roomCarousel" class="carousel slide" data-bs-ride="carousel">
                                    <div class="carousel-inner">
                                        @if (Model.Gallery != null && Model.Gallery.Any())
                                        {
                                            var first = true;
                                            foreach (var image in Model.Gallery)
                                            {
                                                <div class="carousel-item @(first ? "active" : "")">
                                                    <img src="@image.ImageUrl" class="d-block w-100" alt="Phòng">
                                                </div>
                                                first = false;
                                            }
                                        }
                                        else
                                        {
                                            <div class="carousel-item active">
                                                <img src="@(Model.Room.ImageUrl ?? "https://via.placeholder.com/400x300")" class="d-block w-100" alt="Phòng">
                                            </div>
                                        }
                                    </div>
                                    <button class="carousel-control-prev" type="button" data-bs-target="#roomCarousel" data-bs-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Previous</span>
                                    </button>
                                    <button class="carousel-control-next" type="button" data-bs-target="#roomCarousel" data-bs-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="visually-hidden">Next</span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5 class="text-primary">Giá/Đêm: @Model.Room.Price.ToString("N0") đồng</h5>
                                <p><strong>Mô tả:</strong> @Model.Room.Description</p>
                                <!-- Tiện nghi phòng -->
                                <p><strong>Tiện nghi:</strong></p>
                                <ul>
                                    @if (Model.Amenities != null && Model.Amenities.Any())
                                    {
                                        foreach (var amenity in Model.Amenities)
                                        {
                                            <li>@amenity.AmenityName</li>
                                        }
                                    }
                                    else
                                    {
                                        <li>Chưa có thông tin</li>
                                    }
                                </ul>
                            </div>
                        </div>

                        <form asp-action="Create" method="post" id="bookingForm">
                            <input type="hidden" asp-for="RoomId" />
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label asp-for="CheckInDate" class="form-label">Ngày nhận phòng</label>
                                    <input asp-for="CheckInDate" class="form-control flatpickr" required />
                                    <span asp-validation-for="CheckInDate" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="CheckOutDate" class="form-label">Ngày trả phòng</label>
                                    <input asp-for="CheckOutDate" class="form-control flatpickr" required />
                                    <span asp-validation-for="CheckOutDate" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="GuestName" class="form-label">Tên khách hàng</label>
                                    <input asp-for="GuestName" class="form-control" placeholder="Nhập tên của bạn" required />
                                    <span asp-validation-for="GuestName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="GuestEmail" class="form-label">Email</label>
                                    <input asp-for="GuestEmail" class="form-control" placeholder="Nhập email của bạn" required />
                                    <span asp-validation-for="GuestEmail" class="text-danger"></span>
                                </div>
                                <div class="col-12">
                                    <label asp-for="GuestPhone" class="form-label">Số điện thoại</label>
                                    <input asp-for="GuestPhone" class="form-control" placeholder="Nhập số điện thoại" required />
                                    <span asp-validation-for="GuestPhone" class="text-danger"></span>
                                </div>
                                <div class="col-12 text-center mt-4">
                                    <button type="submit" class="btn btn-success btn-lg">Xác nhận đặt phòng</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>
    <script>
        $(document).ready(function () {
            flatpickr(".flatpickr", {
                dateFormat: "d-m-Y",
                minDate: "today",
                locale: {
                    firstDayOfWeek: 1,
                    weekdays: { shorthand: ["CN", "T2", "T3", "T4", "T5", "T6", "T7"], longhand: ["Chủ nhật", "Thứ hai", "Thứ ba", "Thứ tư", "Thứ năm", "Thứ sáu", "Thứ bảy"] },
                    months: {
                        shorthand: ["Th1", "Th2", "Th3", "Th4", "Th5", "Th6", "Th7", "Th8", "Th9", "Th10", "Th11", "Th12"],
                        longhand: ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"]
                    }
                }
            });

            $("#bookingForm").validate({
                rules: {
                    GuestName: { required: true, minlength: 2 },
                    GuestEmail: { required: true, email: true },
                    GuestPhone: { required: true, pattern: /^0[0-9]{9}$/ },
                    CheckInDate: { required: true },
                    CheckOutDate: { required: true }
                },
                messages: {
                    GuestName: { required: "Vui lòng nhập tên", minlength: "Tên phải có ít nhất 2 ký tự" },
                    GuestEmail: { required: "Vui lòng nhập email", email: "Email không đúng định dạng" },
                    GuestPhone: { required: "Vui lòng nhập số điện thoại", pattern: "Số điện thoại phải có 10 số và bắt đầu bằng 0" },
                    CheckInDate: { required: "Vui lòng chọn ngày nhận phòng" },
                    CheckOutDate: { required: "Vui lòng chọn ngày trả phòng" }
                },
                errorElement: "div",
                errorClass: "text-danger"
            });
        });
    </script>
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <style>
        .bg-gradient-primary {
            background: linear-gradient(135deg, #007bff, #00d4ff);
        }
        .card {
            border-radius: 15px;
            overflow: hidden;
        }
        .form-control {
            border-radius: 5px;
            box-shadow: none;
        }
        .btn-success {
            padding: 0.75rem 2rem;
            border-radius: 5px;
        }
    </style>
}